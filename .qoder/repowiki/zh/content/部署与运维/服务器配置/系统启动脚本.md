# ç³»ç»Ÿå¯åŠ¨è„šæœ¬

<cite>
**Referenced Files in This Document**  
- [start-system.sh](file://start-system.sh)
- [backend/src/index.ts](file://backend/src/index.ts)
- [backend/src/index-simple.ts](file://backend/src/index-simple.ts)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
3. [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
4. [æ¶æ„æ¦‚è¿°](#æ¶æ„æ¦‚è¿°)
5. [è¯¦ç»†ç»„ä»¶åˆ†æ](#è¯¦ç»†ç»„ä»¶åˆ†æ)
6. [ä¾èµ–åˆ†æ](#ä¾èµ–åˆ†æ)
7. [æ€§èƒ½è€ƒè™‘](#æ€§èƒ½è€ƒè™‘)
8. [æ•…éšœæ’é™¤æŒ‡å—](#æ•…éšœæ’é™¤æŒ‡å—)
9. [ç»“è®º](#ç»“è®º)

## ç®€ä»‹

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº† `start-system.sh` è„šæœ¬çš„æ‰§è¡Œæµç¨‹å’ŒåŠŸèƒ½å®ç°ï¼Œè¯¥è„šæœ¬ç”¨äºå¯åŠ¨ TriBridge è·¨å¢ƒæ”¯ä»˜ç³»ç»Ÿã€‚æ–‡æ¡£æ¶µç›–äº†åç«¯APIæœåŠ¡çš„å¯åŠ¨æœºåˆ¶ã€å¥åº·æ£€æŸ¥é€»è¾‘ã€è¿›ç¨‹ç®¡ç†ä»¥åŠç³»ç»ŸçŠ¶æ€è¾“å‡ºç­‰å…³é”®åŠŸèƒ½ã€‚

## é¡¹ç›®ç»“æ„

é¡¹ç›®é‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹ç›®å½•ï¼š
- `backend/`ï¼šåç«¯Node.jsæœåŠ¡ï¼Œæä¾›APIæ¥å£
- `pages/` å’Œ `src/`ï¼šå‰ç«¯Next.jsåº”ç”¨
- æ ¹ç›®å½•åŒ…å«ç³»ç»Ÿçº§è„šæœ¬å’Œé…ç½®æ–‡ä»¶

ç³»ç»Ÿå¯åŠ¨è„šæœ¬ä½äºé¡¹ç›®æ ¹ç›®å½•ï¼Œè´Ÿè´£åè°ƒå‰åç«¯æœåŠ¡çš„å¯åŠ¨ä¸å¥åº·æ£€æŸ¥ã€‚

```mermaid
graph TB
StartScript[start-system.sh] --> Backend[backend/]
StartScript --> Frontend[pages/, src/]
Backend --> API[APIæœåŠ¡]
Frontend --> UI[ç”¨æˆ·ç•Œé¢]
```

**Diagram sources**
- [start-system.sh](file://start-system.sh#L1-L41)
- [backend/src/index.ts](file://backend/src/index.ts#L1-L259)

**Section sources**
- [start-system.sh](file://start-system.sh#L1-L41)

## æ ¸å¿ƒç»„ä»¶

`start-system.sh` è„šæœ¬æ˜¯ç³»ç»Ÿå¯åŠ¨çš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£ï¼š
- å¯åŠ¨åç«¯APIæœåŠ¡å¹¶æ•è·å…¶è¿›ç¨‹ID
- ç­‰å¾…æœåŠ¡åˆå§‹åŒ–å¹¶æ‰§è¡Œå¥åº·æ£€æŸ¥
- è¾“å‡ºç³»ç»ŸçŠ¶æ€ä¿¡æ¯
- ç®¡ç†ä¸»è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸ

è„šæœ¬é€šè¿‡bashå‘½ä»¤åºåˆ—åè°ƒç³»ç»Ÿç»„ä»¶çš„å¯åŠ¨æµç¨‹ï¼Œç¡®ä¿æœåŠ¡æŒ‰æ­£ç¡®é¡ºåºåˆå§‹åŒ–ã€‚

**Section sources**
- [start-system.sh](file://start-system.sh#L1-L41)

## æ¶æ„æ¦‚è¿°

ç³»ç»Ÿå¯åŠ¨æµç¨‹éµå¾ªæ¸…æ™°çš„æ‰§è¡Œé¡ºåºï¼Œç¡®ä¿æœåŠ¡ç¨³å®šå¯åŠ¨ï¼š

```mermaid
sequenceDiagram
participant Script as start-system.sh
participant Backend as åç«¯æœåŠ¡
participant HealthCheck as å¥åº·æ£€æŸ¥
Script->>Script : è¾“å‡ºå¯åŠ¨ä¿¡æ¯
Script->>Backend : cd backend && node dist/index-simple.js &
Script->>Script : æ•è·BACKEND_PID
Script->>Script : sleep 3ç§’ç­‰å¾…
Script->>HealthCheck : curl http : //localhost : 8000/health
alt æ£€æŸ¥æˆåŠŸ
HealthCheck-->>Script : è¿”å›200çŠ¶æ€
Script->>Script : è¾“å‡º"âœ… åç«¯APIæœåŠ¡è¿è¡Œæ­£å¸¸"
else æ£€æŸ¥å¤±è´¥
HealthCheck-->>Script : è¿”å›é”™è¯¯
Script->>Script : è¾“å‡º"âŒ åç«¯APIæœåŠ¡å¯åŠ¨å¤±è´¥"
end
Script->>Script : è¾“å‡ºç³»ç»ŸçŠ¶æ€ä¿¡æ¯
Script->>Script : wait $BACKEND_PIDä¿æŒè¿è¡Œ
```

**Diagram sources**
- [start-system.sh](file://start-system.sh#L1-L41)
- [backend/src/index.ts](file://backend/src/index.ts#L85-L89)

## è¯¦ç»†ç»„ä»¶åˆ†æ

### åç«¯æœåŠ¡å¯åŠ¨æœºåˆ¶

è„šæœ¬é€šè¿‡ä¸€ç³»åˆ—bashå‘½ä»¤å¯åŠ¨åç«¯æœåŠ¡ï¼Œå¹¶å»ºç«‹è¿›ç¨‹ç®¡ç†æœºåˆ¶ã€‚

#### æœåŠ¡å¯åŠ¨ä¸PIDæ•è·
```mermaid
flowchart TD
A[æ‰§è¡Œcd backend] --> B[å¯åŠ¨node dist/index-simple.js]
B --> C[ä½¿ç”¨&åå°è¿è¡Œ]
C --> D[æ•è·$!åˆ°BACKEND_PID]
D --> E[è¾“å‡ºPIDä¿¡æ¯]
```

è„šæœ¬ä½¿ç”¨ `&` æ“ä½œç¬¦å°†åç«¯æœåŠ¡ç½®äºåå°è¿è¡Œï¼Œå¹¶é€šè¿‡ `$!` å˜é‡æ•è·å…¶è¿›ç¨‹IDï¼Œå­˜å‚¨åœ¨ `BACKEND_PID` å˜é‡ä¸­ï¼Œä¸ºåç»­è¿›ç¨‹ç®¡ç†æä¾›åŸºç¡€ã€‚

**Diagram sources**
- [start-system.sh](file://start-system.sh#L10-L13)

**Section sources**
- [start-system.sh](file://start-system.sh#L10-L13)

#### å»¶è¿Ÿç­‰å¾…è®¾è®¡
è„šæœ¬åŒ…å«3ç§’å»¶è¿Ÿç­‰å¾…ï¼ˆ`sleep 3`ï¼‰ï¼Œè¿™æ˜¯å…³é”®çš„è®¾è®¡å†³ç­–ï¼Œå…¶æ„å›¾åŒ…æ‹¬ï¼š
- ç»™äºˆNode.jsæœåŠ¡è¶³å¤Ÿçš„åˆå§‹åŒ–æ—¶é—´
- ç¡®ä¿ExpressæœåŠ¡å™¨å®Œæˆç«¯å£ç»‘å®š
- ç­‰å¾…æ•°æ®åº“å’ŒRedisè¿æ¥å»ºç«‹
- é¿å…å¥åº·æ£€æŸ¥åœ¨æœåŠ¡å®Œå…¨å¯åŠ¨å‰æ‰§è¡Œ

æ­¤å»¶è¿Ÿæ—¶é—´åŸºäºæœåŠ¡å¯åŠ¨æ€§èƒ½æµ‹è¯•ç¡®å®šï¼Œå¹³è¡¡äº†å¯åŠ¨é€Ÿåº¦ä¸å¯é æ€§ã€‚

**Section sources**
- [start-system.sh](file://start-system.sh#L15-L17)

### å¥åº·æ£€æŸ¥å®ç°

å¥åº·æ£€æŸ¥æœºåˆ¶æ˜¯ç¡®ä¿æœåŠ¡å¯ç”¨æ€§çš„å…³é”®ç¯èŠ‚ã€‚

#### å¥åº·æ£€æŸ¥æµç¨‹
```mermaid
flowchart TD
Start --> Curl["æ‰§è¡Œcurl -s http://localhost:8000/health"]
Curl --> Check{"å“åº”æˆåŠŸ?"}
Check --> |æ˜¯| Success["è¾“å‡ºâœ… æˆåŠŸä¿¡æ¯"]
Check --> |å¦| Failure["è¾“å‡ºâŒ å¤±è´¥ä¿¡æ¯"]
Success --> End
Failure --> End
```

è„šæœ¬ä½¿ç”¨ `curl` å‘½ä»¤è¯·æ±‚ `/health` ç«¯ç‚¹ï¼Œé€šè¿‡é™é»˜æ¨¡å¼ï¼ˆ`-s`ï¼‰æŠ‘åˆ¶è¿›åº¦è¾“å‡ºï¼Œå¹¶å°†å“åº”é‡å®šå‘åˆ° `/dev/null` ä»…æ£€æŸ¥HTTPçŠ¶æ€ç ã€‚

**Diagram sources**
- [start-system.sh](file://start-system.sh#L18-L21)
- [backend/src/index.ts](file://backend/src/index.ts#L85-L89)

#### å¥åº·ç«¯ç‚¹å®ç°
åç«¯çš„å¥åº·æ£€æŸ¥ç«¯ç‚¹è¿”å›ç»“æ„åŒ–JSONå“åº”ï¼ŒåŒ…å«ç³»ç»Ÿå…³é”®çŠ¶æ€ä¿¡æ¯ï¼š

```json
{
  "status": "healthy",
  "timestamp": "2024-01-01T00:00:00.000Z",
  "version": "1.0.0",
  "environment": "development"
}
```

è¯¥ç«¯ç‚¹æ— éœ€èº«ä»½éªŒè¯ï¼Œå¯åœ¨æœåŠ¡å¯åŠ¨åç«‹å³è®¿é—®ï¼Œä¸ºå¤–éƒ¨ç›‘æ§æä¾›ä¾¿åˆ©ã€‚

**Section sources**
- [backend/src/index.ts](file://backend/src/index.ts#L85-L89)

### è¿›ç¨‹ç®¡ç†æœºåˆ¶

è„šæœ¬æœ«å°¾çš„ `wait $BACKEND_PID` å‘½ä»¤æ˜¯è¿›ç¨‹ç®¡ç†çš„æ ¸å¿ƒï¼Œå…¶åŠŸèƒ½åŒ…æ‹¬ï¼š
- ä¿æŒä¸»shellè¿›ç¨‹è¿è¡Œï¼Œé˜²æ­¢è„šæœ¬ç«‹å³é€€å‡º
- ç›‘å¬åç«¯è¿›ç¨‹çš„ç»ˆæ­¢ä¿¡å·
- æ­£ç¡®å¤„ç†SIGINTï¼ˆCtrl+Cï¼‰å’ŒSIGTERMä¿¡å·
- ç¡®ä¿å­è¿›ç¨‹ç»ˆæ­¢æ—¶ä¸»è„šæœ¬ä¹Ÿèƒ½ä¼˜é›…é€€å‡º

è¿™ç§è®¾è®¡æ¨¡å¼ç¡®ä¿äº†æœåŠ¡åœ¨å‰å°è¿è¡Œï¼Œä¾¿äºæ—¥å¿—æŸ¥çœ‹å’Œä¿¡å·å¤„ç†ã€‚

**Section sources**
- [start-system.sh](file://start-system.sh#L40)

### ç³»ç»ŸçŠ¶æ€è¾“å‡º

è„šæœ¬è¾“å‡ºä¸°å¯Œçš„ç³»ç»ŸçŠ¶æ€ä¿¡æ¯ï¼Œä¸ºç”¨æˆ·æä¾›äº†å®Œæ•´çš„ç³»ç»Ÿè§†å›¾ï¼š

```mermaid
flowchart TD
A[å‰ç«¯UIåœ°å€] --> |"http://localhost:8080"| B[ç”¨æˆ·è®¿é—®å…¥å£]
C[åç«¯APIç«¯å£] --> |"http://localhost:8000"| D[APIæœåŠ¡åœ°å€]
E[å¯ç”¨APIç«¯ç‚¹] --> F["/health"]
E --> G["/api/info"]
E --> H["/api/chains"]
E --> I["/api/test/multichain"]
```

è¿™äº›ä¿¡æ¯å¸®åŠ©ç”¨æˆ·å¿«é€Ÿäº†è§£ç³»ç»Ÿé…ç½®å’Œå¯ç”¨åŠŸèƒ½ã€‚

**Section sources**
- [start-system.sh](file://start-system.sh#L23-L37)

## ä¾èµ–åˆ†æ

ç³»ç»Ÿå¯åŠ¨è„šæœ¬ä¾èµ–äºå¤šä¸ªç»„ä»¶å’Œé…ç½®ï¼š

```mermaid
dependencyDiagram
start-system.sh --> backend
start-system.sh --> node
start-system.sh --> curl
backend --> dist/index-simple.js
backend --> PORTç¯å¢ƒå˜é‡
dist/index-simple.js --> backend/src/index.ts
backend/src/index.ts --> database
backend/src/index.ts --> redis
backend/src/index.ts --> blockchain services
```

**Diagram sources**
- [start-system.sh](file://start-system.sh#L10)
- [backend/src/index.ts](file://backend/src/index.ts#L223-L251)

**Section sources**
- [start-system.sh](file://start-system.sh#L1-L41)
- [backend/src/index.ts](file://backend/src/index.ts#L1-L259)

## æ€§èƒ½è€ƒè™‘

è„šæœ¬è®¾è®¡è€ƒè™‘äº†å¤šä¸ªæ€§èƒ½å’Œå¯é æ€§å› ç´ ï¼š
- 3ç§’å»¶è¿ŸåŸºäºæœåŠ¡å¯åŠ¨æ€§èƒ½æµ‹è¯•ï¼Œå¯è¿›ä¸€æ­¥ä¼˜åŒ–ä¸ºå¾ªç¯æ£€æŸ¥ç›´åˆ°æœåŠ¡å¯ç”¨
- å¥åº·æ£€æŸ¥ä½¿ç”¨è½»é‡çº§HTTPè¯·æ±‚ï¼Œæœ€å°åŒ–ç³»ç»Ÿå¼€é”€
- åå°è¿›ç¨‹ç®¡ç†é¿å…äº†èµ„æºæµªè´¹
- ä¿¡å·å¤„ç†æœºåˆ¶ç¡®ä¿äº†ä¼˜é›…å…³é—­

## æ•…éšœæ’é™¤æŒ‡å—

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

| é—®é¢˜ç°è±¡ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|--------|--------|--------|
| "åç«¯APIæœåŠ¡å¯åŠ¨å¤±è´¥" | æœåŠ¡æœªåœ¨3ç§’å†…å¯åŠ¨ | å¢åŠ sleepæ—¶é—´æˆ–æ£€æŸ¥åç«¯å¯åŠ¨æ€§èƒ½ |
| ç«¯å£8000è¢«å ç”¨ | å…¶ä»–è¿›ç¨‹å ç”¨ç«¯å£ | ä½¿ç”¨`lsof -i :8000`æŸ¥æ‰¾å¹¶ç»ˆæ­¢è¿›ç¨‹ |
| curlå‘½ä»¤æœªæ‰¾åˆ° | ç³»ç»Ÿæœªå®‰è£…curl | å®‰è£…curlå·¥å…· |
| æƒé™é”™è¯¯ | è„šæœ¬æ— æ‰§è¡Œæƒé™ | ä½¿ç”¨`chmod +x start-system.sh` |

### æ‰©å±•å»ºè®®

ä¸ºå¢å¼ºè„šæœ¬åŠŸèƒ½ï¼Œå»ºè®®è¿›è¡Œä»¥ä¸‹æ”¹è¿›ï¼š

#### ç¯å¢ƒå˜é‡æ”¯æŒ
```bash
# æ·»åŠ ç¯å¢ƒå˜é‡æ”¯æŒ
export NODE_ENV=${NODE_ENV:-development}
export PORT=${PORT:-8000}
export FRONTEND_PORT=${FRONTEND_PORT:-8080}
```

#### æ—¥å¿—è®°å½•åŠŸèƒ½
```bash
# æ·»åŠ æ—¥å¿—æ–‡ä»¶è¾“å‡º
exec > >(tee -a startup.log) 2>&1
echo "[$(date)] å¯åŠ¨è¿‡ç¨‹è®°å½•" >> startup.log
```

#### å¤šæœåŠ¡å¹¶è¡Œå¯åŠ¨ä¼˜åŒ–
```bash
# å¹¶è¡Œå¯åŠ¨å¤šä¸ªæœåŠ¡
start_backend() {
    cd backend && node dist/index-simple.js
}
start_frontend() {
    cd frontend && npm start
}
start_backend & BACKEND_PID=$!
start_frontend & FRONTEND_PID=$!
wait $BACKEND_PID $FRONTEND_PID
```

#### å¢å¼ºçš„å¥åº·æ£€æŸ¥
```bash
# å¾ªç¯å¥åº·æ£€æŸ¥ç›´åˆ°æˆåŠŸ
MAX_RETRIES=10
for i in $(seq 1 $MAX_RETRIES); do
    if curl -s http://localhost:8000/health > /dev/null; then
        echo "âœ… åç«¯æœåŠ¡åœ¨${i}æ¬¡å°è¯•åå¯åŠ¨æˆåŠŸ"
        break
    fi
    echo "ğŸ” ç¬¬${i}æ¬¡æ£€æŸ¥å¤±è´¥ï¼Œç­‰å¾…2ç§’åé‡è¯•..."
    sleep 2
done
```

**Section sources**
- [start-system.sh](file://start-system.sh#L1-L41)

## ç»“è®º

`start-system.sh` è„šæœ¬å®ç°äº†ç®€æ´è€Œæœ‰æ•ˆçš„ç³»ç»Ÿå¯åŠ¨æµç¨‹ï¼Œé€šè¿‡bashè„šæœ¬åè°ƒåç«¯æœåŠ¡çš„å¯åŠ¨ã€å¥åº·æ£€æŸ¥å’Œè¿›ç¨‹ç®¡ç†ã€‚è„šæœ¬è®¾è®¡è€ƒè™‘äº†ç”¨æˆ·ä½“éªŒï¼Œæä¾›äº†æ¸…æ™°çš„çŠ¶æ€åé¦ˆå’Œé”™è¯¯ä¿¡æ¯ã€‚é€šè¿‡æ·»åŠ ç¯å¢ƒå˜é‡æ”¯æŒã€æ—¥å¿—è®°å½•å’Œæ›´æ™ºèƒ½çš„å¥åº·æ£€æŸ¥æœºåˆ¶ï¼Œå¯ä»¥è¿›ä¸€æ­¥æå‡è„šæœ¬çš„å¥å£®æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚å½“å‰çš„ `wait $BACKEND_PID` æœºåˆ¶ç¡®ä¿äº†æ­£ç¡®çš„ä¿¡å·å¤„ç†å’Œè¿›ç¨‹æ¸…ç†ï¼Œæ˜¯ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²çš„è‰¯å¥½åŸºç¡€ã€‚